(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["battles-battle"],{"6ed4":function(t,e,n){"use strict";n.r(e);var r=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",[n("v-layout",{attrs:{wrap:""}},[n("v-flex",{attrs:{xs12:"",sm12:"",md4:"","mt-4":"","pl-6":"","mb-4":""}},[n("v-toolbar-title",[t._v("Бой: "+t._s(t.gameBattle.type)+" "+t._s(t.gameBattle._id)+" Status: "+t._s(t.gameBattle.status))])],1),n("v-flex",{attrs:{xs12:"","text-center":""}},[n("div",{staticClass:"cells"},[n("div",{attrs:{id:"svg"}})])])],1),n("ErrorMessage"),n("SuccessMessage")],1)},i=[],a=(n("8e6e"),n("456d"),n("7f7f"),n("7514"),n("6c7b"),n("ac6a"),n("96cf"),n("3b8d")),s=n("bd86"),o=n("2f62"),c=(n("fa7d"),n("3956")),l=n("f916");function u(t,e){var n=Object.keys(t);return Object.getOwnPropertySymbols&&n.push.apply(n,Object.getOwnPropertySymbols(t)),e&&(n=n.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),n}function h(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?u(n,!0).forEach(function(e){Object(s["a"])(t,e,n[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):u(n).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))})}return t}var f={metaInfo:function(){return{title:this.$store.getters.appTitle,titleTemplate:"%s"}},data:function(){return{cell:null,_Grid:null,_grid:null,_draw:null,_listener:null}},computed:h({},Object(o["c"])(["gameBattle","gameBattleUnits","gameBattleCells","renderBattle","user","gameUnits"])),watch:{renderBattle:function(){var t=Object(a["a"])(regeneratorRuntime.mark(function t(e){var n=this;return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:console.log("renderBattle",e),this._grid&&this._grid.forEach(function(t){t.fillContent(n._draw)});case 2:case"end":return t.stop()}},t,this)}));function e(e){return t.apply(this,arguments)}return e}()},methods:h({},Object(o["b"])(["arenaJoin","arenaMove"]),{infoCoord:function(t){return t?"[".concat(t.x,",").concat(t.y,",").concat(t.z,"]"):""},endTurn:function(){var t=Object(a["a"])(regeneratorRuntime.mark(function t(){return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,this.arenaMove({battle:this.gameBattle._id,unit:this.gameBattle.turn,type:"end"});case 2:case"end":return t.stop()}},t,this)}));function e(){return t.apply(this,arguments)}return e}(),atkUnit:function(){var t=Object(a["a"])(regeneratorRuntime.mark(function t(e){return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,this.arenaMove({battle:this.gameBattle._id,unit:this.gameBattle.turn,type:"atk",target:e._id});case 2:case"end":return t.stop()}},t,this)}));function e(e){return t.apply(this,arguments)}return e}(),moveUnit:function(){var t=Object(a["a"])(regeneratorRuntime.mark(function t(e){return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,this.arenaMove({battle:this.gameBattle._id,unit:this.gameBattle.turn,type:"move",target:e._id});case 2:case"end":return t.stop()}},t,this)}));function e(e){return t.apply(this,arguments)}return e}(),drawMap:function(){this._draw=Object(c["a"])().addTo("#svg").size("100%","900");var t=this,e=Object(l["b"])({size:50,render:function(t){var e=this.toPoint();this.poly=t.polygon(this.corners().map(function(t){var e=t.x,n=t.y;return"".concat(e,",").concat(n)})).fill("none").stroke({width:1,color:"#999"}).translate(e.x,e.y)},fillContent:function(e){var n=this,r=this.toPoint(),i=this.center().add(r);this.content&&this.content.length&&this.content.forEach(function(t){t.remove()}),this.content=[];var a=12,s={size:a,anchor:"middle",leading:1.4,fill:"#69c"},o=this.xyz(t.cell?t.cell.coord:null);if(this.cell=t.gameBattleCells.find(function(t){return t.x==o.x&&t.y==o.y&&t.z==o.z}),this.cell&&(this.content.push(e.text("".concat(this.cell._id)).font(s).translate(i.x,i.y+2*a)),this.unit=t.gameBattleUnits.find(function(t){return t.gPos==n.cell._id}),this.unit)){var c=t.gameBattle.commands.find(function(t){return t.acc==n.unit.acc}).side,l=0==c?"#f00":1==c?"#0f0":2==c?"#00f":3==c?"#ff0":4==c?"#f0f":5==c?"#0ff":"#fff";s.fill=l,this.content.push(e.text("".concat(this.unit._id)).font(s).translate(i.x,i.y+-4*a)),this.content.push(e.text("".concat(this.unit.name)).font(s).translate(i.x,i.y+-3*a)),this.content.push(e.text("HP: ".concat(this.unit.points)).font(s).translate(i.x,i.y+-1*a)),this.unit._id==t.gameBattle.turn&&this.content.push(e.text("ХОДИТ").font(s).translate(i.x,i.y+1*a))}},highlight:function(){this.poly.fill({opacity:1,color:"aquamarine"}).animate(1e3).fill({opacity:0,color:"none"}),console.log("cell",t.cell?t.cell._id:""),console.log("cell",this.cell?this.cell._id:""),t.cell&&this.cell._id===t.cell._id&&(this.unit&&this.unit._id==t.gameBattle.turn?t.endTurn():this.unit?t.atkUnit(this.unit):t.moveUnit(this.cell)),t.cell=this.cell},xyz:function(e){var n=this.x-(this.y-(1&this.y))/2-3,r=this.y-t.gameBattle.radius,i=-n-r;return e&&(n+=e.x,i+=e.y,r+=e.z),{x:n,y:i,z:r}}});this._Grid=Object(l["a"])(e),this._grid=this._Grid.hexagon({radius:t.gameBattle.radius,center:[t.gameBattle.radius,t.gameBattle.radius],onCreate:function(e){e.render(t._draw),e.fillContent(t._draw)}}),this._listener=function(e){var n=e.offsetX,r=e.offsetY;console.log("click",n,r);var i=t._Grid.pointToHex([n,r]);console.log("hexCoordinates",i);var a=t._grid.get(i);a&&a.highlight()},c["a"].on(window,"click",this._listener)}}),mounted:function(){var t=Object(a["a"])(regeneratorRuntime.mark(function t(){return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:if(this.gameBattle._id){t.next=2;break}return t.abrupt("return",this.$router.push({name:"battles-arena"}));case 2:return t.next=4,this.arenaJoin({battle:this.gameBattle._id});case 4:this._grid||this.drawMap();case 5:case"end":return t.stop()}},t,this)}));function e(){return t.apply(this,arguments)}return e}(),beforeDestroy:function(){console.log("beforeDestroy"),c["a"].off(window,"click",this._listener)}},d=f,p=(n("a8af"),n("2877")),g=n("6544"),m=n.n(g),v=n("0e8f"),y=n("a722"),b=n("2a7f"),_=Object(p["a"])(d,r,i,!1,null,null,null);e["default"]=_.exports;m()(_,{VFlex:v["a"],VLayout:y["a"],VToolbarTitle:b["c"]})},"7e40":function(t,e,n){},a8af:function(t,e,n){"use strict";var r=n("7e40"),i=n.n(r);i.a}}]);