(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["battles-battle"],{"6ed4":function(t,e,n){"use strict";n.r(e);var i=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",[n("v-layout",{attrs:{wrap:""}},[n("v-flex",{attrs:{xs12:"",sm12:"",md4:"","mt-4":"","pl-6":"","mb-4":""}},[n("v-toolbar-title",[t._v("Бой: "+t._s(t.gameBattle.type)+" "+t._s(t.gameBattle._id)+" Status: "+t._s(t.gameBattle.status))])],1),n("v-flex",{attrs:{xs12:"","text-center":""}},[n("div",{staticClass:"cells"},[n("div",{attrs:{id:"svg"}})])])],1),n("ErrorMessage"),n("SuccessMessage")],1)},r=[],a=(n("8e6e"),n("456d"),n("7f7f"),n("20d6"),n("7514"),n("6c7b"),n("ac6a"),n("96cf"),n("3b8d")),s=n("bd86"),o=n("2f62"),c=(n("fa7d"),n("3956")),l=n("f916");function u(t,e){var n=Object.keys(t);return Object.getOwnPropertySymbols&&n.push.apply(n,Object.getOwnPropertySymbols(t)),e&&(n=n.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),n}function h(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?u(n,!0).forEach(function(e){Object(s["a"])(t,e,n[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):u(n).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))})}return t}var f={metaInfo:function(){return{title:this.$store.getters.appTitle,titleTemplate:"%s"}},data:function(){return{cell:null,_Grid:null,_grid:null,_draw:null,_listener:null}},computed:h({},Object(o["c"])(["gameBattle","gameBattleUnits","gameBattleCells","renderBattle","user","gameUnits"])),watch:{renderBattle:function(){var t=Object(a["a"])(regeneratorRuntime.mark(function t(e){var n=this;return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:console.log("renderBattle",e),this._grid&&this._grid.forEach(function(t){t.fillContent(n._draw)});case 2:case"end":return t.stop()}},t,this)}));function e(e){return t.apply(this,arguments)}return e}()},methods:h({},Object(o["b"])(["battleInfo","battleMove"]),{infoCoord:function(t){return t?"[".concat(t.x,",").concat(t.y,",").concat(t.z,"]"):""},endTurn:function(){var t=Object(a["a"])(regeneratorRuntime.mark(function t(){return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,this.battleMove({battle:this.gameBattle._id,unit:this.gameBattle.queue[this.gameBattle.turn].unit,type:"end"});case 2:case"end":return t.stop()}},t,this)}));function e(){return t.apply(this,arguments)}return e}(),atkUnit:function(){var t=Object(a["a"])(regeneratorRuntime.mark(function t(e){return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,this.battleMove({battle:this.gameBattle._id,unit:this.gameBattle.queue[this.gameBattle.turn].unit,type:"atk",target:e._id});case 2:case"end":return t.stop()}},t,this)}));function e(e){return t.apply(this,arguments)}return e}(),moveUnit:function(){var t=Object(a["a"])(regeneratorRuntime.mark(function t(e){return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,this.battleMove({battle:this.gameBattle._id,unit:this.gameBattle.queue[this.gameBattle.turn].unit,type:"move",target:e._id});case 2:case"end":return t.stop()}},t,this)}));function e(e){return t.apply(this,arguments)}return e}(),drawMap:function(){this._draw=Object(c["a"])().addTo("#svg").size("100%","900");var t=this,e=Object(l["b"])({size:50,render:function(t){var e=this.toPoint();this.poly=t.polygon(this.corners().map(function(t){var e=t.x,n=t.y;return"".concat(e,",").concat(n)})).fill("none").stroke({width:1,color:"#999"}).translate(e.x,e.y)},fillContent:function(e){var n=this,i=this.toPoint(),r=this.center().add(i);this.content&&this.content.length&&this.content.forEach(function(t){t.remove()}),this.content=[];var a=13,s={size:a,anchor:"middle",leading:1.4,fill:"#69c"},o=this.xyz(t.cell?t.cell.coord:null);if(this.cell=t.gameBattleCells.find(function(t){return t.x==o.x&&t.y==o.y&&t.z==o.z}),this.cell){this.content.push(e.text("".concat(this.cell._id)).font(s).translate(r.x,r.y+2*a));var c=t.gameBattle.queue.findIndex(function(t){return t.pos==n.cell._id});if(!(c<0)&&(this.unit=t.gameBattleUnits.find(function(e){return e._id==t.gameBattle.queue[c].unit}),this.unit)){var l=t.gameBattle.commands.find(function(t){return t.acc==n.unit.acc}).side,u=0==l?"#f00":1==l?"#0f0":2==l?"#00f":3==l?"#ff0":4==l?"#f0f":5==l?"#0ff":"#fff";s.fill=u,this.content.push(e.text("".concat(this.unit._id)).font(s).translate(r.x,r.y+-4*a)),this.content.push(e.text("".concat(this.unit.name)).font(s).translate(r.x,r.y+-3*a)),this.content.push(e.text("OP: ".concat(this.unit.points,"/").concat(this.unit.points_)).font(s).translate(r.x,r.y+-2*a)),this.content.push(e.text("HP: ".concat(this.unit.hp,"/").concat(this.unit.hp_)).font(s).translate(r.x,r.y+-1*a)),this.content.push(e.text("MP: ".concat(this.unit.mp,"/").concat(this.unit.mp_)).font(s).translate(r.x,r.y+-0*a)),c==t.gameBattle.turn&&this.content.push(e.text("ХОДИТ").font(s).translate(r.x,r.y+1*a))}}},highlight:function(){this.poly.fill({opacity:1,color:"aquamarine"}).animate(1e3).fill({opacity:0,color:"none"}),console.log("cell",t.cell?t.cell._id:""),console.log("cell",this.cell?this.cell._id:""),t.cell&&this.cell._id===t.cell._id&&(this.unit&&this.unit._id==t.gameBattle.queue[t.gameBattle.turn].unit?t.endTurn():this.unit?t.atkUnit(this.cell):t.moveUnit(this.cell)),t.cell=this.cell},xyz:function(e){var n=this.x-(this.y-(1&this.y))/2-3,i=this.y-t.gameBattle.radius,r=-n-i;return e&&(n+=e.x,r+=e.y,i+=e.z),{x:n,y:r,z:i}}});this._Grid=Object(l["a"])(e),this._grid=this._Grid.hexagon({radius:t.gameBattle.radius,center:[t.gameBattle.radius,t.gameBattle.radius],onCreate:function(e){e.render(t._draw),e.fillContent(t._draw)}}),this._listener=function(e){var n=e.offsetX,i=e.offsetY;console.log("click",n,i);var r=t._Grid.pointToHex([n,i]);console.log("hexCoordinates",r);var a=t._grid.get(r);a&&a.highlight()},c["a"].on(window,"click",this._listener)}}),mounted:function(){var t=Object(a["a"])(regeneratorRuntime.mark(function t(){return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:if(this.gameBattle._id){t.next=2;break}return t.abrupt("return",this.$router.push({name:"battles-arena"}));case 2:return t.next=4,this.battleInfo({battle:this.gameBattle._id});case 4:this._grid||this.drawMap();case 5:case"end":return t.stop()}},t,this)}));function e(){return t.apply(this,arguments)}return e}(),beforeDestroy:function(){console.log("beforeDestroy"),c["a"].off(window,"click",this._listener)}},d=f,p=(n("a8af"),n("2877")),g=n("6544"),m=n.n(g),b=n("0e8f"),y=n("a722"),v=n("2a7f"),x=Object(p["a"])(d,i,r,!1,null,null,null);e["default"]=x.exports;m()(x,{VFlex:b["a"],VLayout:y["a"],VToolbarTitle:v["c"]})},"7e40":function(t,e,n){},a8af:function(t,e,n){"use strict";var i=n("7e40"),r=n.n(i);r.a}}]);